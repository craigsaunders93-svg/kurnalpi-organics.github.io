<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout - Kurnalpi Organics</title>
<link rel="stylesheet" href="style.css">

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-image: url('background.jpg');
    background-size: cover;
    background-attachment: fixed;
    color: white;
}

main {
    padding: 40px;
    position: relative;
}

main::before {
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.5);
    z-index: -1;
}

.container {
    max-width: 900px;
    margin: auto;
    background: rgba(47, 93, 58, 0.9);
    padding: 30px;
    border-radius: 10px;
}

h1, h2 {
    text-align: center;
}

.grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}

@media (max-width: 768px) {
    .grid {
        grid-template-columns: 1fr;
    }
}

label {
    display: block;
    margin-top: 10px;
}

input, textarea {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}

th, td {
    padding: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.2);
}

.summary p {
    display: flex;
    justify-content: space-between;
}

.total {
    font-size: 20px;
    font-weight: bold;
}

button {
    width: 100%;
    margin-top: 10px;
    padding: 12px;
    font-size: 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}

.whatsapp { background: #25d366; color: white; }
.email { background: #ffd700; color: black; }

.eft-box {
    display: none;
    background: #fff;
    color: #000;
    padding: 20px;
    border-radius: 8px;
    margin-top: 15px;
}

.thank-you {
    display: none;
    text-align: center;
}
</style>
</head>

<body>

<header class="site-header">
    <div class="header-inner">
        <a href="index.html"><img src="logo.png" class="logo"></a>
        <nav class="nav">
            <a href="index.html">Home</a>
            <a href="products.html">Products</a>
            <a href="cart.html">Cart</a>
        </nav>
    </div>
</header>

<main>
<div class="container">

<!-- CHECKOUT -->
<div id="checkout-section">
<h1>Checkout</h1>

<div class="grid">
<div>
    <h2>Your Details</h2>

    <label>Name</label>
    <input id="name" required>

    <label>Phone</label>
    <input id="phone" required>

    <label>Email</label>
    <input id="email">

    <label>Delivery Address</label>
    <textarea id="address" required></textarea>

    <label>Notes</label>
    <textarea id="notes"></textarea>
</div>

<div>
    <h2>Order Summary</h2>

    <table>
        <thead>
            <tr><th>Item</th><th>Qty</th><th>Price</th></tr>
        </thead>
        <tbody id="order-items"></tbody>
    </table>

    <div class="summary">
        <p><span>Subtotal</span><span id="subtotal">R0</span></p>
        <p><span>Shipping</span><span>R80</span></p>
        <p class="total"><span>Total</span><span id="total">R0</span></p>
    </div>

    <button class="whatsapp" onclick="checkoutWhatsApp()">Checkout via WhatsApp</button>
    <button class="email" onclick="checkoutEmail()">Checkout via Email</button>
    <button class="email" onclick="showEFT()">Pay via EFT</button>

    <div id="eft-box" class="eft-box">
        <h3>Bank Transfer (EFT)</h3>
        <p><strong>Bank:</strong> FNB</p>
        <p><strong>Account Name:</strong> Kurnalpi Organics</p>
        <p><strong>Account Number:</strong> 6313 4931 898</p>
        <p><strong>Branch Code:</strong> 250655</p>
        <p><strong>Reference:</strong> <span id="eft-ref"></span></p>

        <button class="whatsapp" onclick="eftConfirm()">I Have Paid â€“ Send Order</button>
    </div>
</div>
</div>
</div>

<!-- THANK YOU -->
<div id="thank-you" class="thank-you">
    <h1>Thank You!</h1>
    <p>Your order has been placed successfully.</p>
    <p>We will contact you shortly.</p>
    <button onclick="window.location.href='index.html'">Back to Home</button>
</div>

</div>
</main>

<footer>
&copy; 2026 Kurnalpi Organics
</footer>

<script>
const SHIPPING = 150;

// --------------------
// CART HELPERS
// --------------------
function getCart() {
    return JSON.parse(localStorage.getItem("cart")) || [];
}

function clearCart() {
    localStorage.removeItem("cart");
}

// --------------------
// LOAD CHECKOUT
// --------------------
function loadCheckout() {
    const cart = getCart();

    // Prevent opening checkout with empty cart
    if (cart.length === 0) {
        alert("Your cart is empty.");
        window.location.href = "cart.html";
        return;
    }

    let subtotal = 0;
    const tbody = document.getElementById("order-items");
    tbody.innerHTML = "";

    cart.forEach(item => {
        subtotal += item.price * item.quantity;
        tbody.innerHTML += `
            <tr>
                <td>${item.name}</td>
                <td>${item.quantity}</td>
                <td>R${(item.price * item.quantity).toFixed(2)}</td>
            </tr>
        `;
    });

    document.getElementById("subtotal").textContent = "R" + subtotal.toFixed(2);
    document.getElementById("total").textContent =
        "R" + (subtotal + SHIPPING).toFixed(2);
}

// --------------------
// BUILD MESSAGE
// --------------------
function buildMessage() {
    const cart = getCart();
    let msg = "ORDER DETAILS:%0A%0A";

    cart.forEach(item => {
        msg += `${item.name} x ${item.quantity} - R${(item.price * item.quantity).toFixed(2)}%0A`;
    });

    msg += `%0ATotal (incl shipping): ${document.getElementById("total").textContent}%0A%0A`;
    msg += `Name: ${name.value}%0A`;
    msg += `Phone: ${phone.value}%0A`;
    msg += `Address: ${address.value}`;

    const ref = document.getElementById("eft-ref").textContent;
    if (ref) msg += `%0APayment Ref: ${ref}`;

    return msg;
}

// --------------------
// CHECKOUT ACTIONS
// --------------------
function completeOrder() {
    clearCart();
    document.getElementById("checkout-section").style.display = "none";
    document.getElementById("thank-you").style.display = "block";
}

function checkoutWhatsApp() {
    window.open(
        `https://wa.me/27615136124?text=${buildMessage()}`,
        "_blank"
    );
    completeOrder();
}

function checkoutEmail() {
    window.location.href =
        `mailto:kurnalpiorganics@gmail.com?subject=New Order&body=${buildMessage()}`;
    completeOrder();
}

function showEFT() {
    document.getElementById("eft-ref").textContent =
        "KO-" + Math.floor(100000 + Math.random() * 900000);
    document.getElementById("eft-box").style.display = "block";
}

function eftConfirm() {
    // Show a "Thank You" message or custom confirmation instead of WhatsApp
    document.getElementById("eft-box").style.display = "none"; // Hide EFT payment info
    completeOrder();  // Complete the order process

    alert("Thank you! Your payment via EFT will be confirmed after we receive it. Please use the reference shown during the EFT transfer.");
}


// --------------------
document.addEventListener("DOMContentLoaded", loadCheckout);
</script>

</body>
</html>
